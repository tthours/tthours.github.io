

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="tt">
  <meta name="keywords" content="">
  
    <meta name="description" content="SPF(Sender Policy Framework)作用可以防止别人伪造你来发邮件，是一个反伪造邮件的解决方案。 当你定义了你的邮箱域名的 SPF 记录之后，接收邮件方会根据你的SPF记录来确定连接过来的IP地址是否被包含在 SPF 记录里面，如果在，则认为是一份正确的邮件，否则则认为是一份伪造的邮件。 语法SPF简单说就是域名DNS的txt记录 SPF 记录包含在一个 TXT 记录中 格">
<meta property="og:type" content="article">
<meta property="og:title" content="mailsec_spf">
<meta property="og:url" content="https://tthours.github.io/2024/05/16/security/itsec/mailsec/mailsec_spf/index.html">
<meta property="og:site_name" content="tthours">
<meta property="og:description" content="SPF(Sender Policy Framework)作用可以防止别人伪造你来发邮件，是一个反伪造邮件的解决方案。 当你定义了你的邮箱域名的 SPF 记录之后，接收邮件方会根据你的SPF记录来确定连接过来的IP地址是否被包含在 SPF 记录里面，如果在，则认为是一份正确的邮件，否则则认为是一份伪造的邮件。 语法SPF简单说就是域名DNS的txt记录 SPF 记录包含在一个 TXT 记录中 格">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-05-15T16:00:00.000Z">
<meta property="article:modified_time" content="2024-12-30T11:27:09.388Z">
<meta property="article:author" content="tt">
<meta property="article:tag" content="security">
<meta property="article:tag" content="mailsec">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>mailsec_spf - tthours</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"tthours.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Ten thousand hours</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/hd.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="mailsec_spf"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        tt
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-05-16 00:00" pubdate>
          2024年5月16日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          3k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          25 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">mailsec_spf</h1>
            
            
              <div class="markdown-body">
                
                <span id="more"></span>

<h1 id="SPF-Sender-Policy-Framework"><a href="#SPF-Sender-Policy-Framework" class="headerlink" title="SPF(Sender Policy Framework)"></a>SPF(Sender Policy Framework)</h1><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a><strong>作用</strong></h3><p>可以防止别人伪造你来发邮件，是一个反伪造邮件的解决方案。</p>
<p>当你定义了你的邮箱域名的 SPF 记录之后，接收邮件方会根据你的SPF记录来确定连接过来的IP地址是否被包含在 SPF 记录里面，如果在，则认为是一份正确的邮件，否则则认为是一份伪造的邮件。</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a><strong>语法</strong></h3><p>SPF简单说就是域名DNS的txt记录</p>
<p>SPF 记录包含在一个 TXT 记录中</p>
<h4 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h4><p> <strong>v&#x3D;spf1 [[pre] type [ext]] … [mod]</strong></p>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><p>每个参数的含义：</p>
<p>v&#x3D;spf1 : SPF 的版本，如果使用 Sender ID 的话，这个字段就应该是 v&#x3D;spf2</p>
<p>pre: 定义匹配时的返回值</p>
<p>可能返回值包括：</p>
<p>+，在验证完成的时候表示通过。 </p>
<p>- 表示验证失败。这个值通常是 -all ，表示没有其他任何匹配发生，会直接丢弃邮件。</p>
<p>~ 表示软验证，通常表示验证没有完成，不会直接丢弃邮件，可能会进入垃圾箱或者隔离。 </p>
<p>? 表示不置可否。这个值也通常在测试没有完成的时候使用</p>
<p>type:定义使用的确认测试的类型</p>
<p>可能的值包括：</p>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/alandai/1929489">https://blog.51cto.com/alandai/1929489</a></p>
<p><a target="_blank" rel="noopener" href="http://www.magicwinmail.com/technic_spf.php">http://www.magicwinmail.com/technic_spf.php</a></p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/knowledge_detail/36771.html">https://help.aliyun.com/knowledge_detail/36771.html</a></p>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>v&#x3D;spf1 a mx -all</p>
<p>表示允许a记录和MX服务器的A记录发送邮件</p>
<p>v&#x3D;spf1 a:test.com -all</p>
<p>表示允许test.com域名的a记录发送邮件</p>
<p>v&#x3D;spf1 a&#x2F;24 a:test.test.com&#x2F;24 -all</p>
<p>表示允许a记录的C段都允许,如果test.test.com存在多个A记录地址，每个A记录的C段都允许发送邮件</p>
<p>v&#x3D;spf1 mx mx:test.domain.com -all</p>
<p>表示当前域名的mx记录对应的a记录IP，和test.domain.com的mx记录对应的a记录IP允许发送邮件</p>
<h3 id="查看方法"><a href="#查看方法" class="headerlink" title="查看方法"></a><strong>查看方法</strong></h3><h4 id="Windows："><a href="#Windows：" class="headerlink" title="Windows："></a><strong>Windows：</strong></h4><p><strong>nslookup -q&#x3D;txt domain</strong></p>
<p><strong>nslookup -type&#x3D;txt domain</strong></p>
<h5 id="有SPF的域名"><a href="#有SPF的域名" class="headerlink" title="有SPF的域名"></a>有SPF的域名</h5><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">D:\&gt;nslookup -q=txt qq.com</span><br><span class="hljs-section">服务器:  UnKnown</span><br><span class="hljs-section">Address:  10.211.1.8</span><br><br><span class="hljs-section">非权威应答:</span><br>qq.com  text =<br><br>        <span class="hljs-string">&quot;v=spf1 include:spf.mail.qq.com -all&quot;</span><br></code></pre></td></tr></table></figure>

<p>解释：include:spf.mail.qq.com表示使用spf.mail.qq.com的spf记录</p>
<p>​      -all 表示除spf.mail.qq.com spf设置的IP外，其他的硬拒绝，就是完全不收</p>
<p>因为spf其实最终都是针对IP进行限制的，所以想要看具体限制的IP，可以接着查询对应域名的spf记录，例如查询spf.mail.qq.com</p>
<p><strong>nslookup -type&#x3D;txt spf.mail.qq.com</strong></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs stylus">D:\&gt;nslookup -q=txt spf<span class="hljs-selector-class">.mail</span><span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span><br>服务器:  UnKnown<br>Address:  <span class="hljs-number">10.211</span>.<span class="hljs-number">1.8</span><br><br>非权威应答:<br>spf<span class="hljs-selector-class">.mail</span><span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span> <span class="hljs-selector-tag">text</span> =<br><br>        <span class="hljs-string">&quot;v=spf1 include:qq-a.mail.qq.com include:qq-b.mail.qq.com include:qq-c.mail.qq.com include:biz-a.mail.qq.com include:biz-b.mail.qq.com include:biz-c.mail.qq.com include:biz-d.mail.qq.com -all&quot;</span><br><br>mail<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>     nameserver = ns-cnc2<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span><br>mail<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>     nameserver = ns-cnc1<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span><br>ns-cnc1<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>  internet <span class="hljs-selector-tag">address</span> = <span class="hljs-number">111.161</span>.<span class="hljs-number">107.195</span><br>ns-cnc1<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>  internet <span class="hljs-selector-tag">address</span> = <span class="hljs-number">116.128</span>.<span class="hljs-number">153.20</span><br>ns-cnc1<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>  internet <span class="hljs-selector-tag">address</span> = <span class="hljs-number">58.251</span>.<span class="hljs-number">103.109</span><br>ns-cnc2<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>  internet <span class="hljs-selector-tag">address</span> = <span class="hljs-number">111.161</span>.<span class="hljs-number">107.195</span><br>ns-cnc2<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>  internet <span class="hljs-selector-tag">address</span> = <span class="hljs-number">58.251</span>.<span class="hljs-number">103.109</span><br>ns-cnc1<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>  AAAA IPv6 <span class="hljs-selector-tag">address</span> = <span class="hljs-number">2402</span>:<span class="hljs-number">4</span>e00:<span class="hljs-number">8030</span>::<span class="hljs-number">3</span><br><br>D:\&gt;nslookup -q=txt qq-<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.mail</span><span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span><br>服务器:  UnKnown<br>Address:  <span class="hljs-number">10.211</span>.<span class="hljs-number">1.8</span><br><br>非权威应答:<br>qq-<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.mail</span><span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>        <span class="hljs-selector-tag">text</span> =<br><br>        <span class="hljs-string">&quot;v=spf1 ip4:101.226.139.0/25 ip4:101.91.43.0/25 ip4:101.91.44.128/25 ip4:112.64.237.128/25 ip4:116.128.173.0/25 ip4:121.51.40.128/25 ip4:121.51.6.0/25 ip4:162.62.52.214 ip4:162.62.55.67 ip4:162.62.57.0/24 ip4:162.62.58.211 ip4:162.62.58.216 -all&quot;</span><br><br>mail<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>     nameserver = ns-cnc1<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span><br>mail<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>     nameserver = ns-cnc2<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span><br>ns-cnc1<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>  internet <span class="hljs-selector-tag">address</span> = <span class="hljs-number">116.128</span>.<span class="hljs-number">153.20</span><br>ns-cnc1<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>  internet <span class="hljs-selector-tag">address</span> = <span class="hljs-number">58.251</span>.<span class="hljs-number">103.109</span><br>ns-cnc1<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>  internet <span class="hljs-selector-tag">address</span> = <span class="hljs-number">111.161</span>.<span class="hljs-number">107.195</span><br>ns-cnc2<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>  internet <span class="hljs-selector-tag">address</span> = <span class="hljs-number">58.251</span>.<span class="hljs-number">103.109</span><br>ns-cnc2<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>  internet <span class="hljs-selector-tag">address</span> = <span class="hljs-number">111.161</span>.<span class="hljs-number">107.195</span><br>ns-cnc1<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>  AAAA IPv6 <span class="hljs-selector-tag">address</span> = <span class="hljs-number">2402</span>:<span class="hljs-number">4</span>e00:<span class="hljs-number">8030</span>::<span class="hljs-number">3</span><br></code></pre></td></tr></table></figure>

<h5 id="没有spf的记录"><a href="#没有spf的记录" class="headerlink" title="没有spf的记录"></a><strong>没有spf的记录</strong></h5><p>nslookup -type&#x3D;txt 165.com</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">D:\&gt;nslookup -<span class="hljs-keyword">type</span>=txt <span class="hljs-number">165.</span>com<br>服务器:  <span class="hljs-type">UnKnown</span><br>Address:  <span class="hljs-number">10.211</span><span class="hljs-number">.1</span><span class="hljs-number">.8</span><br><br><span class="hljs-number">165.</span>com<br>        <span class="hljs-keyword">primary</span> <span class="hljs-type">name</span> <span class="hljs-keyword">server</span> = coby.ns.cloudflare.com<br>        responsible mail addr = dns.cloudflare.com<br>        <span class="hljs-type">serial</span>  = <span class="hljs-number">2036766500</span><br>        <span class="hljs-keyword">refresh</span> = <span class="hljs-number">10000</span> (<span class="hljs-number">2</span> hours <span class="hljs-number">46</span> mins <span class="hljs-number">40</span> secs)<br>        retry   = <span class="hljs-number">2400</span> (<span class="hljs-number">40</span> mins)<br>        expire  = <span class="hljs-number">604800</span> (<span class="hljs-number">7</span> days)<br>        <span class="hljs-keyword">default</span> TTL = <span class="hljs-number">3600</span> (<span class="hljs-number">1</span> hour)<br></code></pre></td></tr></table></figure>



<h4 id="mac-linux"><a href="#mac-linux" class="headerlink" title="mac &#x2F; linux"></a><strong>mac &#x2F; linux</strong></h4><h5 id="dig"><a href="#dig" class="headerlink" title="dig"></a><strong>dig</strong></h5><p>​	<strong>dig -t txt domain</strong></p>
<h5 id="host"><a href="#host" class="headerlink" title="host"></a><strong>host</strong></h5><p>​	<strong>host -t txt domain</strong></p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dns">(base) [root@<span class="hljs-number">110</span> ~]# host -t txt qq.com<br>qq.com descriptive text &quot;v=spf1 include:spf.mail.qq.com -all&quot;<br><br>(base) [root@<span class="hljs-number">110</span> ~]# host -t txt spf.mail.qq.com<br>spf.mail.qq.com descriptive text &quot;v=spf1 include:qq-a.mail.qq.com include:qq-b.mail.qq.com include:qq-c.mail.qq.com include:biz-a.mail.qq.com include:biz-b.mail.qq.com include:biz-c.mail.qq.com include:biz-d.mail.qq.com -all&quot;<br><br>(base) [root@<span class="hljs-number">110</span> ~]# host -t txt qq-a.mail.qq.com<br>qq-a.mail.qq.com descriptive text &quot;v=spf1 ip<span class="hljs-number">4:101.226.139</span>.<span class="hljs-number">0</span>/<span class="hljs-number">25</span> ip<span class="hljs-number">4:101.91.43</span>.<span class="hljs-number">0</span>/<span class="hljs-number">25</span> ip<span class="hljs-number">4:101.91.44</span>.<span class="hljs-number">128</span>/<span class="hljs-number">25</span> ip<span class="hljs-number">4:112.64.237</span>.<span class="hljs-number">128</span>/<span class="hljs-number">25</span> ip<span class="hljs-number">4:116.128.173</span>.<span class="hljs-number">0</span>/<span class="hljs-number">25</span> ip<span class="hljs-number">4:121.51.40</span>.<span class="hljs-number">128</span>/<span class="hljs-number">25</span> ip<span class="hljs-number">4:121.51.6</span>.<span class="hljs-number">0</span>/<span class="hljs-number">25</span> ip<span class="hljs-number">4:162.62.52</span>.<span class="hljs-number">214</span> ip<span class="hljs-number">4:162.62.55</span>.<span class="hljs-number">67</span> ip<span class="hljs-number">4:162.62.57</span>.<span class="hljs-number">0</span>/<span class="hljs-number">24</span> ip<span class="hljs-number">4:162.62.58</span>.<span class="hljs-number">211</span> ip<span class="hljs-number">4:162.62.58</span>.<span class="hljs-number">216</span> -all&quot;<br></code></pre></td></tr></table></figure>









<h3 id="设置方法"><a href="#设置方法" class="headerlink" title="设置方法"></a><strong>设置方法</strong></h3><p>也可以说spf记录就是DNS解析记录</p>
<p>在阿里云上，可以直接添加一条记录</p>
<p>v&#x3D;spf1 ip4:121.43.138.1 -all</p>
<p>表示只有从 121.43.138.1 发送的邮件为合法邮件，其他的全部拒绝。</p>
<h3 id="软硬拒绝"><a href="#软硬拒绝" class="headerlink" title="软硬拒绝"></a>软硬拒绝</h3><h4 id="软拒绝"><a href="#软拒绝" class="headerlink" title="软拒绝"></a>软拒绝</h4><p>~ 软拒绝，硬拒绝会丢弃很多邮件，为避免这种情况，会设置为软拒绝，如果设置软拒绝，表示发件IP非法，但是不采取强硬措施，可能会标为垃圾邮件等</p>
<p>test.site的 SPF 设置为软拒绝</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">┌──(root㉿<span class="hljs-number">61804e0083</span>af)-[/]<br>└─<span class="hljs-comment"># host -t txt test.site</span><br>vict.site descriptive <span class="hljs-built_in">text</span> <span class="hljs-string">&quot;v=spf1 ip4:121.43.138.1 ~all&quot;</span><br></code></pre></td></tr></table></figure>

<h5 id="软拒绝-伪造的邮件QQ邮箱拒绝"><a href="#软拒绝-伪造的邮件QQ邮箱拒绝" class="headerlink" title="软拒绝-伪造的邮件QQ邮箱拒绝"></a>软拒绝-伪造的邮件QQ邮箱拒绝</h5><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs clean">┌──(root㉿<span class="hljs-number">61804e0083</span>af)-[/]<br>└─# swaks --to test@foxmail.com --<span class="hljs-keyword">from</span> admin@test.site --body <span class="hljs-string">&quot;~all to qq&quot;</span><br>=== Trying mx3.qq.com:<span class="hljs-number">25.</span>..<br>=== Connected to mx3.qq.com.<br>&lt;-  <span class="hljs-number">220</span> newxmmxszb1<span class="hljs-number">-2.</span>qq.com MX QQ Mail Server.<br> -&gt; EHLO <span class="hljs-number">61804e0083</span>af<br>&lt;-  <span class="hljs-number">250</span>-newxmmxszb1<span class="hljs-number">-2.</span>qq.com<br>&lt;-  <span class="hljs-number">250</span>-STARTTLS<br>&lt;-  <span class="hljs-number">250</span><span class="hljs-number">-8</span>BITMIME<br>&lt;-  <span class="hljs-number">250</span>-SIZE <span class="hljs-number">73400320</span><br>&lt;-  <span class="hljs-number">250</span> OK<br> -&gt; MAIL FROM:&lt;admin@test.site&gt;<br>&lt;-  <span class="hljs-number">250</span> OK<br> -&gt; RCPT TO:&lt;test@foxmail.com&gt;<br>&lt;-  <span class="hljs-number">250</span> OK<br> -&gt; DATA<br>&lt;-  <span class="hljs-number">354</span> End data <span class="hljs-keyword">with</span> &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;.<br> -&gt; Date: Sun, <span class="hljs-number">09</span> Apr <span class="hljs-number">2023</span> <span class="hljs-number">08</span>:<span class="hljs-number">36</span>:<span class="hljs-number">55</span> +<span class="hljs-number">0000</span><br> -&gt; To: test@foxmail.com<br> -&gt; From: admin@test.site<br> -&gt; Subject: test Sun, <span class="hljs-number">09</span> Apr <span class="hljs-number">2023</span> <span class="hljs-number">08</span>:<span class="hljs-number">36</span>:<span class="hljs-number">55</span> +<span class="hljs-number">0000</span><br> -&gt; Message-Id: &lt;<span class="hljs-number">20230409083655.000017</span>@<span class="hljs-number">61804e0083</span>af&gt;<br> -&gt; X-Mailer: swaks v20201014<span class="hljs-number">.0</span> jetmore.org/john/<span class="hljs-keyword">code</span>/swaks/<br> -&gt; <br> -&gt; ~all to qq<br> -&gt; <br> -&gt; <br> -&gt; .<br><br>&lt;** <span class="hljs-number">550</span> SPF check failed [MO+TD704vLucbv7Hd8BASEhQm5HgwZ88L3vGy9OWHck+hKp4HTLoROmFlo7u7dv/KQ==  IP: <span class="hljs-number">61.135</span><span class="hljs-number">.152</span><span class="hljs-number">.141</span>]. https:<span class="hljs-comment">//service.mail.qq.com/detail/122/72.</span><br> -&gt; QUIT<br>&lt;-  <span class="hljs-number">221</span> Bye.<br>=== Connection closed <span class="hljs-keyword">with</span> remote host.<br><br></code></pre></td></tr></table></figure>

<p>提示SPF检查失败</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smali">550 SPF<span class="hljs-built_in"> check </span>failed [MO+TD704vLucbv7Hd8BASEhQm5HgwZ88L3vGy9OWHck+hKp4HTLoROmFlo7u7dv/KQ==  IP: 61.135.152.141]. https://service.mail.qq.com/detail/122/72.<br></code></pre></td></tr></table></figure>



<h5 id="软拒绝-伪造的邮件163邮箱接收"><a href="#软拒绝-伪造的邮件163邮箱接收" class="headerlink" title="软拒绝-伪造的邮件163邮箱接收"></a>软拒绝-伪造的邮件163邮箱接收</h5><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs clean">┌──(root㉿<span class="hljs-number">61804e0083</span>af)-[/]<br>└─# swaks --to test@<span class="hljs-number">163.</span>com --<span class="hljs-keyword">from</span> admin@test.site --body <span class="hljs-string">&quot;all forgery to 163 &quot;</span><br>=== Trying <span class="hljs-number">163</span>mx02.mxmail.netease.com:<span class="hljs-number">25.</span>..<br>=== Connected to <span class="hljs-number">163</span>mx02.mxmail.netease.com.<br>&lt;-  <span class="hljs-number">220</span> <span class="hljs-number">163.</span>com Anti-spam GT for Coremail System (<span class="hljs-number">163</span>com[<span class="hljs-number">20141201</span>])<br> -&gt; EHLO <span class="hljs-number">61804e0083</span>af<br>&lt;-  <span class="hljs-number">250</span>-mail<br>&lt;-  <span class="hljs-number">250</span>-PIPELINING<br>&lt;-  <span class="hljs-number">250</span>-AUTH LOGIN PLAIN<br>&lt;-  <span class="hljs-number">250</span>-AUTH=LOGIN PLAIN<br>&lt;-  <span class="hljs-number">250</span>-coremail <span class="hljs-number">1</span>Uxr2xKj7kG0xkI17xGrU7I0s8FY2U3Uj8Cz28x1UUUUU7Ic2I0Y2Ur8Yv9BUCa0xDrUUUUj<br>&lt;-  <span class="hljs-number">250</span>-STARTTLS<br>&lt;-  <span class="hljs-number">250</span>-SIZE <span class="hljs-number">73400320</span><br>&lt;-  <span class="hljs-number">250</span> <span class="hljs-number">8</span>BITMIME<br> -&gt; MAIL FROM:&lt;admin@test.site&gt;<br>&lt;-  <span class="hljs-number">250</span> Mail OK<br> -&gt; RCPT TO:&lt;test@<span class="hljs-number">163.</span>com&gt;<br>&lt;-  <span class="hljs-number">250</span> Mail OK<br> -&gt; DATA<br>&lt;-  <span class="hljs-number">354</span> End data <span class="hljs-keyword">with</span> &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;<br> -&gt; Date: Sun, <span class="hljs-number">09</span> Apr <span class="hljs-number">2023</span> <span class="hljs-number">08</span>:<span class="hljs-number">49</span>:<span class="hljs-number">46</span> +<span class="hljs-number">0000</span><br> -&gt; To: test@<span class="hljs-number">163.</span>com<br> -&gt; From: admin@test.site<br> -&gt; Subject: test Sun, <span class="hljs-number">09</span> Apr <span class="hljs-number">2023</span> <span class="hljs-number">08</span>:<span class="hljs-number">49</span>:<span class="hljs-number">46</span> +<span class="hljs-number">0000</span><br> -&gt; Message-Id: &lt;<span class="hljs-number">20230409084946.000022</span>@<span class="hljs-number">61804e0083</span>af&gt;<br> -&gt; X-Mailer: swaks v20201014<span class="hljs-number">.0</span> jetmore.org/john/<span class="hljs-keyword">code</span>/swaks/<br> -&gt; <br> -&gt; all forgery to <span class="hljs-number">163</span> <br> -&gt; <br> -&gt; <br> -&gt; .<br>&lt;-  <span class="hljs-number">250</span> Mail OK queued <span class="hljs-keyword">as</span> zwqz-mx-mta-g3<span class="hljs-number">-3</span>,_____wD3hm4rfDJkLRh1AQ-<span class="hljs-number">-.34322</span>S2 <span class="hljs-number">1681030189</span><br> -&gt; QUIT<br>&lt;-  <span class="hljs-number">221</span> Bye<br>=== Connection closed <span class="hljs-keyword">with</span> remote host.<br></code></pre></td></tr></table></figure>

<p>会在信头的Authentication-Results字段中显示 spf 为软失败</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Authentication-Results: zwqz-mx-mta-g3-3; <span class="hljs-attribute">spf</span>=softfail smtp.<span class="hljs-attribute">mail</span>=admin@test.site;<br></code></pre></td></tr></table></figure>



<h5 id="软拒绝-伪造的邮件google邮箱拒绝"><a href="#软拒绝-伪造的邮件google邮箱拒绝" class="headerlink" title="软拒绝-伪造的邮件google邮箱拒绝"></a>软拒绝-伪造的邮件google邮箱拒绝</h5><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs clean">┌──(root㉿c87bd1816ee7)-[/]<br>└─# swaks --to test@gmail.com --<span class="hljs-keyword">from</span> admin@test.site --body <span class="hljs-string">&quot;all forgery to google &quot;</span><br>=== Trying gmail-smtp-<span class="hljs-keyword">in</span>.l.google.com:<span class="hljs-number">25.</span>..<br>=== Connected to gmail-smtp-<span class="hljs-keyword">in</span>.l.google.com.<br>&lt;-  <span class="hljs-number">220</span> mx.google.com ESMTP u17<span class="hljs-number">-20020</span>a63ef11000000b004fba312c235si5393252pgh<span class="hljs-number">.411</span> - gsmtp<br> -&gt; EHLO c87bd1816ee7<br>&lt;-  <span class="hljs-number">250</span>-mx.google.com at your service, [<span class="hljs-number">111.194</span><span class="hljs-number">.122</span><span class="hljs-number">.157</span>]<br>&lt;-  <span class="hljs-number">250</span>-SIZE <span class="hljs-number">157286400</span><br>&lt;-  <span class="hljs-number">250</span><span class="hljs-number">-8</span>BITMIME<br>&lt;-  <span class="hljs-number">250</span>-STARTTLS<br>&lt;-  <span class="hljs-number">250</span>-ENHANCEDSTATUSCODES<br>&lt;-  <span class="hljs-number">250</span>-PIPELINING<br>&lt;-  <span class="hljs-number">250</span>-CHUNKING<br>&lt;-  <span class="hljs-number">250</span> SMTPUTF8<br> -&gt; MAIL FROM:&lt;admin@test.site&gt;<br>&lt;-  <span class="hljs-number">250</span> <span class="hljs-number">2.1</span><span class="hljs-number">.0</span> OK u17<span class="hljs-number">-20020</span>a63ef11000000b004fba312c235si5393252pgh<span class="hljs-number">.411</span> - gsmtp<br> -&gt; RCPT TO:&lt;test@gmail.com&gt;<br>&lt;-  <span class="hljs-number">250</span> <span class="hljs-number">2.1</span><span class="hljs-number">.5</span> OK u17<span class="hljs-number">-20020</span>a63ef11000000b004fba312c235si5393252pgh<span class="hljs-number">.411</span> - gsmtp<br> -&gt; DATA<br>&lt;-  <span class="hljs-number">354</span>  Go ahead u17<span class="hljs-number">-20020</span>a63ef11000000b004fba312c235si5393252pgh<span class="hljs-number">.411</span> - gsmtp<br> -&gt; Date: Sat, <span class="hljs-number">08</span> Apr <span class="hljs-number">2023</span> <span class="hljs-number">07</span>:<span class="hljs-number">08</span>:<span class="hljs-number">31</span> +<span class="hljs-number">0000</span><br> -&gt; To: test@gmail.com<br> -&gt; From: admin@test.site<br> -&gt; Subject: test Sat, <span class="hljs-number">08</span> Apr <span class="hljs-number">2023</span> <span class="hljs-number">07</span>:<span class="hljs-number">08</span>:<span class="hljs-number">31</span> +<span class="hljs-number">0000</span><br> -&gt; Message-Id: &lt;<span class="hljs-number">20230408070831.000062</span>@c87bd1816ee7&gt;<br> -&gt; X-Mailer: swaks v20201014<span class="hljs-number">.0</span> jetmore.org/john/<span class="hljs-keyword">code</span>/swaks/<br> -&gt;<br> -&gt; all forgery to google<br> -&gt;<br> -&gt;<br> -&gt; .<br>&lt;** <span class="hljs-number">550</span><span class="hljs-number">-5.7</span><span class="hljs-number">.26</span> The MAIL FROM domain [vict.site] has an SPF record <span class="hljs-keyword">with</span> a hard fail<br>&lt;** <span class="hljs-number">550</span><span class="hljs-number">-5.7</span><span class="hljs-number">.26</span> policy (-all) but it fails to pass SPF checks <span class="hljs-keyword">with</span> the ip:<br>&lt;** <span class="hljs-number">550</span><span class="hljs-number">-5.7</span><span class="hljs-number">.26</span> [<span class="hljs-number">111.194</span><span class="hljs-number">.122</span><span class="hljs-number">.157</span>]. To best protect our users <span class="hljs-keyword">from</span> spam and phishing,<br>&lt;** <span class="hljs-number">550</span><span class="hljs-number">-5.7</span><span class="hljs-number">.26</span> the message has been blocked. Please visit<br>&lt;** <span class="hljs-number">550</span><span class="hljs-number">-5.7</span><span class="hljs-number">.26</span>  https:<span class="hljs-comment">//support.google.com/mail/answer/81126#authentication for more</span><br>&lt;** <span class="hljs-number">550</span> <span class="hljs-number">5.7</span><span class="hljs-number">.26</span> information. u17<span class="hljs-number">-20020</span>a63ef11000000b004fba312c235si5393252pgh<span class="hljs-number">.411</span> - gsmtp<br> -&gt; QUIT<br>*** Remote host closed connection unexpectedly.<br></code></pre></td></tr></table></figure>



<h4 id="硬拒绝"><a href="#硬拒绝" class="headerlink" title="硬拒绝"></a>硬拒绝</h4><p>- 硬拒绝，</p>
<p>-all</p>
<p>vict.site的 SPF 设置为硬拒绝</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">┌──(root㉿<span class="hljs-number">61804e0083</span>af)-[/]<br>└─<span class="hljs-comment"># host -t txt test.site</span><br>vict.site descriptive <span class="hljs-built_in">text</span> <span class="hljs-string">&quot;v=spf1 ip4:121.43.138.1 -all&quot;</span><br></code></pre></td></tr></table></figure>

<h5 id="硬拒绝-伪造的邮件QQ邮箱拒绝"><a href="#硬拒绝-伪造的邮件QQ邮箱拒绝" class="headerlink" title="硬拒绝-伪造的邮件QQ邮箱拒绝"></a>硬拒绝-伪造的邮件QQ邮箱拒绝</h5><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs clean">┌──(root㉿<span class="hljs-number">61804e0083</span>af)-[/]<br>└─# swaks --to test@foxmail.com --<span class="hljs-keyword">from</span> admin@test.site --body <span class="hljs-string">&quot;all forgery to qq&quot;</span><br>=== Trying mx3.qq.com:<span class="hljs-number">25.</span>..<br>=== Connected to mx3.qq.com.<br>&lt;-  <span class="hljs-number">220</span> newxmmxszc6<span class="hljs-number">-2.</span>qq.com MX QQ Mail Server.<br> -&gt; EHLO <span class="hljs-number">61804e0083</span>af<br>&lt;-  <span class="hljs-number">250</span>-newxmmxszc6<span class="hljs-number">-2.</span>qq.com<br>&lt;-  <span class="hljs-number">250</span>-STARTTLS<br>&lt;-  <span class="hljs-number">250</span><span class="hljs-number">-8</span>BITMIME<br>&lt;-  <span class="hljs-number">250</span>-SIZE <span class="hljs-number">73400320</span><br>&lt;-  <span class="hljs-number">250</span> OK<br> -&gt; MAIL FROM:&lt;admin@test.site&gt;<br>&lt;-  <span class="hljs-number">250</span> OK<br> -&gt; RCPT TO:&lt;test@foxmail.com&gt;<br>&lt;-  <span class="hljs-number">250</span> OK<br> -&gt; DATA<br>&lt;-  <span class="hljs-number">354</span> End data <span class="hljs-keyword">with</span> &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;.<br> -&gt; Date: Sat, <span class="hljs-number">25</span> Mar <span class="hljs-number">2023</span> <span class="hljs-number">08</span>:<span class="hljs-number">58</span>:<span class="hljs-number">40</span> +<span class="hljs-number">0000</span><br> -&gt; To: test@foxmail.com<br> -&gt; From: admin@test.site<br> -&gt; Subject: test Sat, <span class="hljs-number">25</span> Mar <span class="hljs-number">2023</span> <span class="hljs-number">08</span>:<span class="hljs-number">58</span>:<span class="hljs-number">40</span> +<span class="hljs-number">0000</span><br> -&gt; Message-Id: &lt;<span class="hljs-number">20230325085840.000144</span>@<span class="hljs-number">61804e0083</span>af&gt;<br> -&gt; X-Mailer: swaks v20201014<span class="hljs-number">.0</span> jetmore.org/john/<span class="hljs-keyword">code</span>/swaks/<br> -&gt; <br> -&gt; all forgery to qq<br> -&gt; <br> -&gt; <br> -&gt; .<br>&lt;** <span class="hljs-number">550</span> SPF check failed [MPheda7H5r2WwJffxgMR71aZMUWOXuOHHJuHE5PjvsqCDHQ3wc0MOqsrBXS2MiwuNQ==  IP: <span class="hljs-number">61.135</span><span class="hljs-number">.152</span><span class="hljs-number">.140</span>]. https:<span class="hljs-comment">//service.mail.qq.com/detail/122/72.</span><br> -&gt; QUIT<br>&lt;-  <span class="hljs-number">221</span> Bye.<br>=== Connection closed <span class="hljs-keyword">with</span> remote host.<br></code></pre></td></tr></table></figure>



<h5 id="硬拒绝-伪造的邮件163邮箱拒绝"><a href="#硬拒绝-伪造的邮件163邮箱拒绝" class="headerlink" title="硬拒绝-伪造的邮件163邮箱拒绝"></a>硬拒绝-伪造的邮件163邮箱拒绝</h5><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs clean">┌──(root㉿<span class="hljs-number">61804e0083</span>af)-[/]<br>└─# swaks --to test@<span class="hljs-number">163.</span>com --<span class="hljs-keyword">from</span> admin@test.site --body <span class="hljs-string">&quot;all forgery to 163 &quot;</span><br>=== Trying <span class="hljs-number">163</span>mx03.mxmail.netease.com:<span class="hljs-number">25.</span>..<br>=== Connected to <span class="hljs-number">163</span>mx03.mxmail.netease.com.<br>&lt;-  <span class="hljs-number">220</span> <span class="hljs-number">163.</span>com Anti-spam GT for Coremail System (<span class="hljs-number">163</span>com[<span class="hljs-number">20141201</span>])<br> -&gt; EHLO <span class="hljs-number">61804e0083</span>af<br>&lt;-  <span class="hljs-number">250</span>-mail<br>&lt;-  <span class="hljs-number">250</span>-PIPELINING<br>&lt;-  <span class="hljs-number">250</span>-AUTH LOGIN PLAIN<br>&lt;-  <span class="hljs-number">250</span>-AUTH=LOGIN PLAIN<br>&lt;-  <span class="hljs-number">250</span>-coremail <span class="hljs-number">1</span>Uxr2xKj7kG0xkI17xGrU7I0s8FY2U3Uj8Cz28x1UUUUU7Ic2I0Y2UFbexPCUCa0xDrUUUUj<br>&lt;-  <span class="hljs-number">250</span>-STARTTLS<br>&lt;-  <span class="hljs-number">250</span>-SIZE <span class="hljs-number">73400320</span><br>&lt;-  <span class="hljs-number">250</span> <span class="hljs-number">8</span>BITMIME<br> -&gt; MAIL FROM:&lt;admin@test.site&gt;<br>&lt;-  <span class="hljs-number">250</span> Mail OK<br> -&gt; RCPT TO:&lt;test@<span class="hljs-number">163.</span>com&gt;<br>&lt;-  <span class="hljs-number">250</span> Mail OK<br> -&gt; DATA<br>&lt;-  <span class="hljs-number">354</span> End data <span class="hljs-keyword">with</span> &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;<br> -&gt; Date: Sat, <span class="hljs-number">25</span> Mar <span class="hljs-number">2023</span> <span class="hljs-number">08</span>:<span class="hljs-number">53</span>:<span class="hljs-number">24</span> +<span class="hljs-number">0000</span><br> -&gt; To: test@<span class="hljs-number">163.</span>com<br> -&gt; From: admin@test.site<br> -&gt; Subject: test Sat, <span class="hljs-number">25</span> Mar <span class="hljs-number">2023</span> <span class="hljs-number">08</span>:<span class="hljs-number">53</span>:<span class="hljs-number">24</span> +<span class="hljs-number">0000</span><br> -&gt; Message-Id: &lt;<span class="hljs-number">20230325085324.000123</span>@<span class="hljs-number">61804e0083</span>af&gt;<br> -&gt; X-Mailer: swaks v20201014<span class="hljs-number">.0</span> jetmore.org/john/<span class="hljs-keyword">code</span>/swaks/<br> -&gt; <br> -&gt; all forgery to <span class="hljs-number">163</span> <br> -&gt; <br> -&gt; <br> -&gt; .<br>&lt;** <span class="hljs-number">550</span> DI:SPF <span class="hljs-number">163</span> mx65,EN1pCgAnf1uEth5knwhKCw-<span class="hljs-number">-.17116</span>S2 <span class="hljs-number">1679734404</span>,please see http:<span class="hljs-comment">//mail.163.com/help/help_spam_16.htm?ip=218.30.113.52&amp;hostid=mx65&amp;time=1679734404</span><br> -&gt; QUIT<br>&lt;-  <span class="hljs-number">221</span> Bye<br>=== Connection closed <span class="hljs-keyword">with</span> remote host.<br></code></pre></td></tr></table></figure>



<h5 id="软拒绝-伪造的邮件google邮箱拒绝-1"><a href="#软拒绝-伪造的邮件google邮箱拒绝-1" class="headerlink" title="软拒绝-伪造的邮件google邮箱拒绝"></a>软拒绝-伪造的邮件google邮箱拒绝</h5><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs clean">┌──(root㉿<span class="hljs-number">61804e0083</span>af)-[/]<br>└─# swaks --to test@gmail.com --<span class="hljs-keyword">from</span> admin@test.site --body <span class="hljs-string">&quot;~all forgery to google &quot;</span><br>=== Trying gmail-smtp-<span class="hljs-keyword">in</span>.l.google.com:<span class="hljs-number">25.</span>..<br>=== Connected to gmail-smtp-<span class="hljs-keyword">in</span>.l.google.com.<br>&lt;-  <span class="hljs-number">220</span> mx.google.com ESMTP b6<span class="hljs-number">-20020</span>a170902d50600b0019f243b2dccsi6100977plg<span class="hljs-number">.415</span> - gsmtp<br> -&gt; EHLO c87bd1816ee7<br>&lt;-  <span class="hljs-number">250</span>-mx.google.com at your service, [<span class="hljs-number">111.194</span><span class="hljs-number">.122</span><span class="hljs-number">.157</span>]<br>&lt;-  <span class="hljs-number">250</span>-SIZE <span class="hljs-number">157286400</span><br>&lt;-  <span class="hljs-number">250</span><span class="hljs-number">-8</span>BITMIME<br>&lt;-  <span class="hljs-number">250</span>-STARTTLS<br>&lt;-  <span class="hljs-number">250</span>-ENHANCEDSTATUSCODES<br>&lt;-  <span class="hljs-number">250</span>-PIPELINING<br>&lt;-  <span class="hljs-number">250</span>-CHUNKING<br>&lt;-  <span class="hljs-number">250</span> SMTPUTF8<br> -&gt; MAIL FROM:&lt;admin@test.site&gt;<br>&lt;-  <span class="hljs-number">250</span> <span class="hljs-number">2.1</span><span class="hljs-number">.0</span> OK b6<span class="hljs-number">-20020</span>a170902d50600b0019f243b2dccsi6100977plg<span class="hljs-number">.415</span> - gsmtp<br> -&gt; RCPT TO:&lt;test@gmail.com&gt;<br>&lt;-  <span class="hljs-number">250</span> <span class="hljs-number">2.1</span><span class="hljs-number">.5</span> OK b6<span class="hljs-number">-20020</span>a170902d50600b0019f243b2dccsi6100977plg<span class="hljs-number">.415</span> - gsmtp<br> -&gt; DATA<br>&lt;-  <span class="hljs-number">354</span>  Go ahead b6<span class="hljs-number">-20020</span>a170902d50600b0019f243b2dccsi6100977plg<span class="hljs-number">.415</span> - gsmtp<br> -&gt; Date: Sat, <span class="hljs-number">08</span> Apr <span class="hljs-number">2023</span> <span class="hljs-number">07</span>:<span class="hljs-number">02</span>:<span class="hljs-number">37</span> +<span class="hljs-number">0000</span><br> -&gt; To: test@gmail.com<br> -&gt; From: admin@test.site<br> -&gt; Subject: test Sat, <span class="hljs-number">08</span> Apr <span class="hljs-number">2023</span> <span class="hljs-number">07</span>:<span class="hljs-number">02</span>:<span class="hljs-number">37</span> +<span class="hljs-number">0000</span><br> -&gt; Message-Id: &lt;<span class="hljs-number">20230408070237.000051</span>@c87bd1816ee7&gt;<br> -&gt; X-Mailer: swaks v20201014<span class="hljs-number">.0</span> jetmore.org/john/<span class="hljs-keyword">code</span>/swaks/<br> -&gt;<br> -&gt;  all forgery to google<br> -&gt;<br> -&gt;<br> -&gt; .<br>&lt;** <span class="hljs-number">550</span><span class="hljs-number">-5.7</span><span class="hljs-number">.26</span> The MAIL FROM domain [vict.site] has an SPF record <span class="hljs-keyword">with</span> a hard fail<br>&lt;** <span class="hljs-number">550</span><span class="hljs-number">-5.7</span><span class="hljs-number">.26</span> policy (-all) but it fails to pass SPF checks <span class="hljs-keyword">with</span> the ip:<br>&lt;** <span class="hljs-number">550</span><span class="hljs-number">-5.7</span><span class="hljs-number">.26</span> [<span class="hljs-number">111.194</span><span class="hljs-number">.122</span><span class="hljs-number">.157</span>]. To best protect our users <span class="hljs-keyword">from</span> spam and phishing,<br>&lt;** <span class="hljs-number">550</span><span class="hljs-number">-5.7</span><span class="hljs-number">.26</span> the message has been blocked. Please visit<br>&lt;** <span class="hljs-number">550</span><span class="hljs-number">-5.7</span><span class="hljs-number">.26</span>  https:<span class="hljs-comment">//support.google.com/mail/answer/81126#authentication for more</span><br>&lt;** <span class="hljs-number">550</span> <span class="hljs-number">5.7</span><span class="hljs-number">.26</span> information. b6<span class="hljs-number">-20020</span>a170902d50600b0019f243b2dccsi6100977plg<span class="hljs-number">.415</span> - gsmtp<br> -&gt; QUIT<br>*** Remote host closed connection unexpectedly.<br></code></pre></td></tr></table></figure>





<h3 id="SPF绕过"><a href="#SPF绕过" class="headerlink" title="SPF绕过"></a>SPF绕过</h3><h4 id="配置不当"><a href="#配置不当" class="headerlink" title="配置不当"></a>配置不当</h4><h5 id="ip-范围过大"><a href="#ip-范围过大" class="headerlink" title="ip 范围过大"></a>ip 范围过大</h5><p>v&#x3D;spf1 ip4:113.113.1.1&#x2F;16 </p>
<p>允许范围为 113.113.1.1-113.113.255.255，会存在拿下一台服务器就可以实现绕过</p>
<h5 id="spf-软拒绝"><a href="#spf-软拒绝" class="headerlink" title="spf 软拒绝"></a>spf 软拒绝</h5><p>由于硬拒绝会直接拒收不符合条件的邮件，为避免邮件丢失，很多企业都会将SPF设置为软拒绝。这样就会导致存在</p>
<h5 id="spf-记录格式错误"><a href="#spf-记录格式错误" class="headerlink" title="spf 记录格式错误"></a>spf 记录格式错误</h5><p>特别注意，多个IP段，确保每个IP段的开头都是 ipv4</p>
<h5 id="邮件服务器未配置支持-spf"><a href="#邮件服务器未配置支持-spf" class="headerlink" title="邮件服务器未配置支持 spf"></a>邮件服务器未配置支持 spf</h5><p>spf有两步，第一步是在域名添加spf记录，第二步是在邮件服务器上配置支持spf</p>
<p>如果邮件服务器没有配置支持 spf，就例如我们声明了，但是无法验证</p>
<h5 id="spf-配置DNS错误"><a href="#spf-配置DNS错误" class="headerlink" title="spf 配置DNS错误"></a>spf 配置DNS错误</h5><p>spf 解析在公网 DNS，内部邮件服务器配置的是内网 DNS ，内网 DNS 无法解析 spf ，也就是邮件服务器无法使用公网 spf 验证</p>
<h5 id="内网缺乏限制"><a href="#内网缺乏限制" class="headerlink" title="内网缺乏限制"></a>内网缺乏限制</h5><p>攻击者进入内网，如果内部邮件服务器信任内网IP且开启</p>
<h3 id="SPF-报错"><a href="#SPF-报错" class="headerlink" title="SPF 报错"></a>SPF 报错</h3><h4 id="SPF-PermError-Too-Many-DNS-Lookups"><a href="#SPF-PermError-Too-Many-DNS-Lookups" class="headerlink" title="SPF PermError: Too Many DNS Lookups"></a>SPF PermError: Too Many DNS Lookups</h4><p>RFC 规范文档 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7208">RFC7208</a> 规定每次SPF检查 DNS查询的 mechanisms 和 modifier 限制在十次以内，包括 include mechanism 或 redirect modifier 带来的查询。也就是说 SPF 查询所有允许IP的所需要的查询次数不可以超过 10 次，否则会返回“SPF PermError：too many DNS lookups”，SPF 永久错误在 DMARC 中被解释为 fail，从而会降低邮件送达率。</p>
<p>规避由于SPF DNS 查询造成的DDoS攻击，攻击过程为攻击者将可控的域名SPF记录指向被攻击域名，攻击者通过向不同的邮件服务器发送大量邮件，导致被攻击域名接受到 SPF DNS 查询的流量，如果被攻击域名SPF记录层级没有限制，就会造成DDoS攻击，如果限制在10次以内，放大倍数最多也就10倍，可以大幅度缓解攻击力度。</p>
<p>SPF查询次数查看</p>
<p><a target="_blank" rel="noopener" href="https://dmarcly.com/tools/spf-record-checker">https://dmarcly.com/tools/spf-record-checker</a></p>
<p>解决方法</p>
<p>1、确保查询不要超过10次</p>
<p>2、使用 safe SPF ，也就是通过 dmarcly 生成特定的SPF记录规避超过十次</p>
<p>例如：</p>
<p>qq.com的SPF会被压缩如下SPF记录，需要更新原本域名的SPF记录</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">v=spf1 include:_u<span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span>._spf<span class="hljs-selector-class">.dmarcld</span><span class="hljs-selector-class">.com</span> -<br></code></pre></td></tr></table></figure>











<h3 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h3><p>SPF验证 envelope From 地址，不验证头域 From地址</p>
<p>查看收件方SPF校验结果</p>
<p>gmail</p>
<p>显示原始邮件</p>
<p>163</p>
<p>查看信头，Authentication-Results字段可查看spf验证结果</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Authentication-Results: zwqz-mx-mta-g2-3; <span class="hljs-attribute">spf</span>=pass smtp.<span class="hljs-attribute">mail</span>=admin@vict.site;<br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/security/" class="category-chain-item">security</a>
  
  
    <span>></span>
    
  <a href="/categories/security/mailsec/" class="category-chain-item">mailsec</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/security/" class="print-no-link">#security</a>
      
        <a href="/tags/mailsec/" class="print-no-link">#mailsec</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>mailsec_spf</div>
      <div>https://tthours.github.io/2024/05/16/security/itsec/mailsec/mailsec_spf/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>tt</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年5月16日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              TT
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/05/17/yunwei/errors/Linuxerrors/error_almalinux_no_init.d/" title="error_almalinux_no_init.d">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">error_almalinux_no_init.d</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/05/16/security/itsec/mailsec/mailsec_swaks/" title="mailsec_swaks">
                        <span class="hidden-mobile">mailsec_swaks</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
